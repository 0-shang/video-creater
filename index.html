<!DOCTYPE html>
<html lang="zh" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoopsHub - ç¯®çƒè§†é¢‘åº“</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        body { background-color: #0f0f0f; color: #f1f1f1; min-height: 100vh; }
        .card { background-color: #1f1f1f; border: none; transition: 0.2s; cursor: pointer; }
        .card:hover { transform: translateY(-5px); background-color: #2a2a2a; }
        .navbar { background-color: #0f0f0f; border-bottom: 1px solid #333; }
        .hide { display: none !important; }
        /* æ’­æ”¾å™¨å®¹å™¨é™åˆ¶é«˜åº¦ */
        .player-wrapper { max-width: 1000px; margin: 0 auto; }
    </style>
</head>
<body>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold text-danger" href="index.html">ğŸ€ HoopsHub</a>
            <span class="text-secondary small">é™æ€ç‰ˆ</span>
        </div>
    </nav>

    <div class="container">
        <!-- 1. è§†é¢‘åˆ—è¡¨åŒºåŸŸ (é»˜è®¤æ˜¾ç¤º) -->
        <div id="gallery-view">
            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4" id="video-list">
                <!-- JS ä¼šæŠŠè§†é¢‘æ’å…¥åˆ°è¿™é‡Œ -->
            </div>
            <p id="loading-text" class="text-center text-muted mt-5">æ­£åœ¨åŠ è½½è§†é¢‘åº“...</p>
        </div>

        <!-- 2. æ’­æ”¾å™¨åŒºåŸŸ (é»˜è®¤éšè—) -->
        <div id="player-view" class="hide">
            <div class="mb-3">
                <a href="index.html" class="text-decoration-none text-info">â† è¿”å›åˆ—è¡¨</a>
            </div>
            <div class="player-wrapper">
                <div class="plyr__video-embed" id="player">
                    <!-- iframe ä¼šè¢« JS åŠ¨æ€æ³¨å…¥ -->
                </div>
            </div>
            <h3 class="mt-3" id="video-title">æ ‡é¢˜</h3>
        </div>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
        // --- æ ¸å¿ƒé€»è¾‘ ---

        // 1. è·å– URL ä¸­çš„ ?v=ID å‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const videoId = urlParams.get('v');

        // 2. è¯»å– videos.json æ•°æ®
        fetch('videos.json')
            .then(response => response.json())
            .then(videos => {
                document.getElementById('loading-text').classList.add('hide');

                if (videoId) {
                    // --- æ’­æ”¾æ¨¡å¼ ---
                    renderPlayer(videoId, videos);
                } else {
                    // --- åˆ—è¡¨æ¨¡å¼ ---
                    renderGallery(videos);
                }
            })
            .catch(err => {
                document.getElementById('loading-text').innerText = "åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ videos.json æ˜¯å¦å­˜åœ¨";
                console.error(err);
            });

        function renderGallery(videos) {
            const container = document.getElementById('video-list');
            
            if (videos.length === 0) {
                container.innerHTML = '<div class="text-center w-100">æš‚æ— è§†é¢‘</div>';
                return;
            }

            videos.forEach(video => {
                const html = `
                    <div class="col">
                        <div class="card h-100" onclick="window.location.href='?v=${video.id}'">
                            <div class="ratio ratio-16x9">
                                <img src="${video.thumbnail}" class="card-img-top object-fit-cover" loading="lazy">
                            </div>
                            <div class="card-body">
                                <h6 class="card-title text-truncate">${video.title}</h6>
                                <small class="text-secondary">Youtube</small>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function renderPlayer(targetId, videos) {
            // éšè—åˆ—è¡¨ï¼Œæ˜¾ç¤ºæ’­æ”¾å™¨
            document.getElementById('gallery-view').classList.add('hide');
            document.getElementById('player-view').classList.remove('hide');

            // æŸ¥æ‰¾å¯¹åº”è§†é¢‘æ•°æ®
            const video = videos.find(v => v.id === targetId);
            
            if (!video) {
                document.getElementById('video-title').innerText = "æœªæ‰¾åˆ°è¯¥è§†é¢‘";
                return;
            }

            // è®¾ç½®æ ‡é¢˜
            document.getElementById('video-title').innerText = video.title;
            document.title = "æ’­æ”¾: " + video.title;

            // åŠ¨æ€æ„å»º Iframe
            const playerContainer = document.getElementById('player');
            playerContainer.innerHTML = `
                <iframe
                    src="https://www.youtube.com/embed/${video.id}?origin=${location.origin}&iv_load_policy=3&modestbranding=1&playsinline=1&showinfo=0&rel=0&enablejsapi=1"
                    allowfullscreen
                    allowtransparency
                    allow="autoplay"
                ></iframe>
            `;

            // åˆå§‹åŒ– Plyr
            const player = new Plyr('#player', {
                captions: { active: true, update: true, language: 'zh' }
            });

            // æŒ‚è½½å­—å¹• (å¦‚æœåœ¨ JSON é‡Œæœ‰è®°å½•)
            if (video.sub_url) {
                // æ„å»ºå­—å¹• Source
                // æ³¨æ„ï¼šGitHub Pages ä¸Šè¿™é‡Œç›´æ¥å¼•ç”¨ç›¸å¯¹è·¯å¾„å³å¯
                // Plyr åœ¨ iframe æ¨¡å¼ä¸‹æŒ‚è½½å¤–éƒ¨å­—å¹•æ¯”è¾ƒ trickyï¼Œé€šå¸¸éœ€è¦ WebVTT ä¸”æ— è·¨åŸŸé—®é¢˜
                // å¦‚æœæ˜¯çº¯é™æ€ï¼Œè¿™é‡Œä»…ä½œè®°å½•ï¼Œå®é™…æ•ˆæœå–å†³äº Plyr å¯¹ Iframe çš„æ§åˆ¶èƒ½åŠ›
                console.log("å­—å¹•æ–‡ä»¶è·¯å¾„:", video.sub_url);
            }
        }
    </script>
</body>
</html>